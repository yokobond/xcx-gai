## 三目並べ
構造化出力を使った、生成AIと対戦する三目並べのプロジェクトの例です。

### ゲームの進行

1. 緑の旗を押してAIと接続します。
2. ネコをクリックすると、AIがゲームマスターとして振る舞い、三目並べを開始します。
3. あなたが先手です。盤面の空いているマスをクリックして、あなたのマーク（◯）を置きます。
4. しばらくすると、AIが考えて、盤面にマーク（✕）を置きます。
5. AIが次の手を打たずに考えていると返答したときは、ネコをクリックするとAIに次の手を催促できます。
6. 交互にマークを置いていき、先に縦、横、斜めのいずれかに自分のマークを3つ並べた方が勝ちです。
7. ゲームが終了したら、再びネコをクリックすると新しいゲームを始められます。

<iframe src="https://xcratch.github.io/editor/player#https://yokobond.github.io/xcx-gai/docs/ja/gai-tic_tac_toe-ja.sb3" width="540px" height="460px"></iframe>


### プロジェクトの説明

このプロジェクトでは、生成AIのモデルを使って、三目並べの進行を行うゲームマスターをAIで実装しています。
ゲームマスターとして振る舞う指示は、 `systemInstruction` として次のように与えられています。

```
あなたは、フレンドリーで少しユーモラスな三目並べ（○×ゲーム）の対戦相手AIです。以下のルールと設定に従って、ユーザーと三目並べをプレイしてください。

# ゲームの基本ルール
- 3x3の盤面を使用します。
- プレイヤーとAIが交互に印を1箇所ずつ置きます。
- 先に自分の印を縦、横、斜めのいずれかに3つ並べた方が勝利です。
- 全てのマスが埋まっても勝敗がつかない場合は引き分けです。

# 盤面の座標系
- 盤面はアルファベット（列）と数字（行）の組み合わせでマスを指定します。
- 列は A, B, C のいずれかです。
- 行は 1, 2, 3 のいずれかです。
- 指定例: A1, B2, C3 など。

# 使用する印
- プレイヤーは常に 'O' を使用します。
- あなた（AI）は常に 'X' を使用します。

# AIの戦略
- あなたは三目並べの基本的な戦略に従ってプレイします。
- 可能な手番では、まず自分が勝てる手（リーチ）があればそれを選びます。
- 次に、プレイヤーが次の手で勝てる場所があれば、それを防ぎます。
- 上記に該当しない場合、中央 (B2)、角 (A1, C1, A3, C3)、辺の中央 (B1, A2, C2, B3) の順で有利なマスを選びます。
- 同じ優先度のマスが複数ある場合は、その中からランダムに選びます。

# 対話スタイル (JSONのmessageフィールドにて表現)
- 親しみやすく、礼儀正しい言葉遣いを心がけてください。
- ユーザーが楽しめるように、ゲームの進行を明確に伝え、時には軽いジョークや励ましの言葉を挟んでも構いません。
- ユーザーの入力が不正な場合（例: 範囲外の座標、既に印があるマス）は、優しく指摘し、再入力を促してください。

# 応答形式
- あなたの応答は、必ず以下のJSON形式でなければなりません。
- 盤面の各マスは、空きマスなら "_ " (アンダースコア)、プレイヤーの印なら "O"、AIの印なら "X" で表現してください。
- `board` は3x3の2次元配列で、board[行インデックス][列インデックス] とします。
- 行インデックス: 0 (1行目), 1 (2行目), 2 (3行目)
- 列インデックス: 0 (A列), 1 (B列), 2 (C列)

# ゲームの状態管理
- 現在の盤面、どちらのターンか、ゲームが終了したかなどを正確に記憶し、JSON応答に反映してください。
```

AIは、プレイヤーの手を表す文字列を入力として受け取り、次に置くマークの位置やゲームの進行状態をJSON形式で出力します。
返答に利用するJSONのフォーマットは、`responseSchema` として定義されています。

このプロジェクトでは、OpenAPIの仕様を使って、以下のスキーマを定義しています。

```json
{
  "type": "object",
  "description": "三目並べゲームの現在の状態とAIからのメッセージを含むJSON応答。",
  "properties": {
    "board": {
      "type": "array",
      "description": "三目並べの3x3盤面。行の配列（3要素）で、各行は列の配列（3要素）。セルの値は '_' (アンダースコア), 'O' (プレイヤー), 'X' (AI)。board[行インデックス][列インデックス]でアクセス。",
      "items": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": ["_", "O", "X"],
          "description": "盤面のセルの状態。"
        },
        "minItems": 3,
        "maxItems": 3,
        "description": "盤面の1行（3セル）。"
      },
      "minItems": 3,
      "maxItems": 3
    },
    "currentPlayer": {
      "type": "string",
      "enum": ["player", "ai", "none"],
      "description": "現在のターンプレイヤー。'player'はユーザー、'ai'はAI、'none'はゲーム終了時など。"
    },
    "gameStatus": {
      "type": "string",
      "enum": ["not_started", "ongoing", "player_win", "ai_win", "draw"],
      "description": "現在のゲームの状態。"
    },
    "message": {
      "type": "string",
      "description": "AIからユーザーへのテキストメッセージ。"
    },
    "aiMove": {
      "type": "object",
      "nullable": true,
      "description": "AIが手を打った場合の情報。AIの手番でない場合、ゲーム開始前、またはゲーム終了時はnullまたは省略されることがあります。",
      "properties": {
        "coordinate": {
          "type": "string",
          "pattern": "^[ABC][123]$",
          "description": "AIが打ったマスの座標 (例: 'A1', 'B2', 'C3')。"
        },
        "reason": {
          "type": "string",
          "description": "AIがその手を選んだ理由（任意）。"
        }
      },
      "required": ["coordinate"]
    }
  },
  "required": [
    "board",
    "currentPlayer",
    "gameStatus",
    "message"
  ]
}
```
